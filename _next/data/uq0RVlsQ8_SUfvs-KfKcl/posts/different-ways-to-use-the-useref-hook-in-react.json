{"pageProps":{"postData":{"id":"different-ways-to-use-the-useref-hook-in-react","content":"\n## Introduction\n\nOne of my favorite features that [React](https://react.dev/) introduced is [React Hooks](https://react.dev/reference/react) - I mentioned this before in my [previous post](/posts/how-to-integrate-with-a-rest-api-using-react-hooks-and-typescript-with-tests/). React Hooks allow you to use state and other React features without writing a class, making it easier to build React components and features. One hook that I find particularly useful is [`React.useRef`](https://react.dev/reference/react/useRef). Although it is often used to manipulate the [DOM](https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model), it has other use cases as well. In this article, we'll explore different ways to use the useRef hook. Let's get started!\n\n## What is React.useRef?\n\n`React.useRef` is one of the built-in hooks introduced in React. It lets you reference a value that's not needed for rendering or it allows you persist values between renders. To put it simply, it's a way to store a value that doesn't cause a re-render when updated.\n\nNow that you know what `useRef` is, let's find out the different ways you can use it.\n\n## Manipulating the DOM with a ref\n\nManipulating the DOM with a ref is the most common way to use `useRef`. It allows you to access a child element imperatively.\n\nHere's an example of a component that will automatically focus on the input element on mount:\n\n```tsx\nimport { useRef, useEffect } from 'react';\n\nfunction MyComponent() {\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    inputRef.current?.focus();\n  }, []);\n\n  return <input ref={inputRef} type=\"email\" />;\n}\n```\n\n---\n\n## Referencing a value with a ref and using it in a callback\n\nYou can also store different kinds of data inside a ref. This is useful when you want to use a value that's not needed for rendering, like storing an interval ID.\n\nHere's an example of a component that will increment a counter every second, and you can stop the interval with a click of a button:\n\n```tsx\nimport { useRef, useState, useEffect } from 'react';\n\nfunction MyComponent() {\n  const intervalIdRef = useRef(0);\n  const [counter, setCounter] = useState(0);\n\n  const stopInterval = () => {\n    window.clearInterval(intervalIdRef.current);\n  };\n\n  useEffect(() => {\n    intervalIdRef.current = window.setInterval(() => {\n      setCounter((prevCounter) => prevCounter + 1);\n    }, 1000);\n\n    return () => {\n      stopInterval();\n    };\n  }, []);\n\n  return (\n    <div>\n      <p>Counter: {counter}</p>\n      <button onClick={stopInterval}>Stop interval</button>\n    </div>\n  );\n}\n```\n\n## Referencing a value with a ref and using it in a useEffect\n\nYou can also use a ref to store a value that you want to access in a [`React.useEffect`](https://react.dev/reference/react/useEffect) hook. This is useful if for example you have a window event listener that can only get the updated value from a ref.\n\nHere's an example of a component that will increment a counter every second and log the current value of the counter when the user clicks on the screen:\n\n```tsx\nimport { useRef, useState, useEffect } from 'react';\n\nfunction MyComponent() {\n  const [counter, setCounter] = useState(0);\n  const counterRef = useRef(0);\n\n  const increaseCount = () => {\n    counterRef.current += 1;\n    setCounter(counterRef.current);\n  };\n\n  useEffect(() => {\n    const intervalId = window.setInterval(increaseCount, 1000);\n\n    const handleMouseDown = () =>\n      console.log(`The current counter is ${counterRef.current}`);\n\n    window.addEventListener('mousedown', handleMouseDown);\n\n    return () => {\n      window.clearInterval(intervalId);\n      window.removeEventListener('mousedown', handleMouseDown);\n    };\n  }, []);\n\n  return <p>Counter: {counter}</p>;\n}\n```\n\n---\n\nHere's a custom hook that extends the functionality of [`React.useState`](https://react.dev/reference/react/useState) and provides a ref to the current state:\n\n```tsx\n// lib/custom-hooks.ts\nimport { useState, useRef } from 'react';\n\nexport function useStateRef<S>(defaultValue: S) {\n  const ref = useRef<S>(defaultValue);\n  const [state, _setState] = useState<S>(defaultValue);\n  const setState = (value: S) => {\n    ref.current = value;\n    _setState(value);\n  };\n\n  return [state, setState, ref] as const;\n}\n```\n\nIf you're new to [TypeScript](https://www.typescriptlang.org/), you might be wondering what the `S` type is. It's a [generic type](https://www.typescriptlang.org/docs/handbook/2/generics.html) that allows you to pass a type to the function. In this case, we're passing the type of the state to the `useStateRef` function. This allows us to use the same function for different types of state. As for the `as const` part, it's a [TypeScript assertion](https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#type-assertions) that tells TypeScript that the array returned by the `useStateRef` function will always have the same types.\n\nUsing this hook can make it easier to use a ref in a `useEffect` hook. Here's the updated version of the previous example using the `useStateRef` hook:\n\n```tsx\n...\nimport {useStateRef} from './lib/custom-hooks';\n\nfunction MyComponent() {\n  const [counter, setCounter, counterRef] = useStateRef(0);\n\n  const increaseCount = () => {\n    setCounter(counterRef.current + 1);\n  };\n\n  useEffect(() => {\n    ...\n  }, []);\n\n  return <p>Counter: {counter}</p>;\n}\n\n```\n\n---\n\n## More complex examples\n\nWhile the examples we've seen so far are simple, `useRef` can also be used for more complex use cases. For instance, you might need to allow the user to drag a box around the screen. In this case, you can use `useRef` to store the initial position of the mouse when the user clicks on the box, and then use it to calculate the new position of the box as the user moves the mouse.\n\nHere's an example of a component that lets you drag a box around:\n\n```tsx\nimport React, { useRef, useState } from 'react';\n\nfunction MyComponent() {\n  const previousPositionRef = useRef({ x: 0, y: 0 });\n  const initialPositionRef = useRef({ x: 0, y: 0 });\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n\n  const handleMouseMove = (e: MouseEvent) => {\n    setPosition({\n      x:\n        previousPositionRef.current.x +\n        e.clientX -\n        initialPositionRef.current.x,\n      y:\n        previousPositionRef.current.y +\n        e.clientY -\n        initialPositionRef.current.y,\n    });\n  };\n\n  const handleMouseUp = () => {\n    window.removeEventListener('mouseup', handleMouseUp);\n    window.removeEventListener('mousemove', handleMouseMove);\n  };\n\n  const handleMouseDown = (e: React.MouseEvent<HTMLDivElement>) => {\n    previousPositionRef.current = position;\n    initialPositionRef.current = {\n      x: e.clientX,\n      y: e.clientY,\n    };\n\n    window.addEventListener('mouseup', handleMouseUp);\n    window.addEventListener('mousemove', handleMouseMove);\n  };\n\n  return (\n    <div\n      style={{\n        position: 'absolute',\n        top: position.y,\n        left: position.x,\n        width: 100,\n        height: 100,\n        backgroundColor: 'red',\n      }}\n      onMouseDown={handleMouseDown}\n      onMouseUp={handleMouseUp}\n    />\n  );\n}\n```\n\n---\n\nAnother example or use case is when you have two states that you need to be included in a callback function but the useEffect hook only has one state as a dependency. You can use a ref to store the value of the other state and then use it in the callback function.\n\nHere's an example of a component that has two inputs and logs the values of both inputs when the first input changes:\n\n```tsx\nimport { useState, useEffect, useRef } from 'react';\n\nfunction MyComponent() {\n  const [firstData, setFirstData] = useState('John');\n  const [secondData, _setSecondData] = useState('Doe');\n  const secondDataRef = useRef(secondData);\n\n  useEffect(() => {\n    console.log({ firstData, secondData: secondDataRef.current });\n    // TODO: do something with these two values\n  }, [firstData]);\n\n  useEffect(() => {\n    secondDataRef.current = secondData;\n  }, [secondData]);\n\n  return (\n    <div>\n      <input\n        type=\"text\"\n        value={firstData}\n        onChange={(e) => setFirstData(e.target.value)}\n      />\n      <input\n        type=\"text\"\n        value={secondData}\n        onChange={(e) => setSecondData(e.target.value)}\n      />\n    </div>\n  );\n}\n```\n\nHere you might notice that I'm updating the value of `secondDataRef` in a separate `useEffect` hook using `secondData` as the dependency. This is another way to ensure that the value of `secondDataRef` is always up-to-date instead of creating a separate setState function for `secondData`.\n\nWhile you could technically just log `secondData` in the `useEffect` hook, doing so would give you a lint warning because `secondData` is not a dependency of the hook, and there may be times when its value is not updated. By using `useRef`, you can ensure that the value of `secondData` is always up-to-date before the `useEffect` hook runs.\n\nAlso while I'm just logging the values of the two inputs in the `useEffect` hook, you could do something more complex with them. For instance, you could make an [API](https://developer.mozilla.org/en-US/docs/Glossary/API) call using the values of the two inputs but only call the API when the first input changes.\n\n## Conclusion\n\nThat's it for this article. We have covered the different ways you can use `useRef` in your React components. I hope this article was useful for you and that you learned something new.\n\nDon't forget to check out the official React documentation for more information about `useRef`.\n\nThanks for reading!\n\n## References\n\n- [React.useRef documentation](https://react.dev/reference/react/useRef)\n- [Legacy React.useRef documentation](https://legacy.reactjs.org/docs/hooks-reference.html#useref)\n","previousPost":{"id":"embassy-of-japan-in-singapore-visa-appointment-notification-service-for-visa-tourism-applications","title":"Embassy of Japan in Singapore Visa Appointment Notification Service for Visa (Tourism) applications","date":"2023-03-24","excerpt":"A web application that lets you subscribe to email notifications for new booking slots","category":"technology","videoUrl":""},"nextPost":null,"title":"Different ways to use the useRef hook in React","date":"2023-04-07","excerpt":"Learn about the various use cases of React's useRef hook","category":"technology","videoUrl":"https://youtu.be/RLwE5R5ZSuQ"}},"__N_SSG":true}